{% extends "catalogue/base.html" %}
{% block head %}
	{{form.media.css}}
{% endblock %}

{% block content %}
<div class="col-md-12 d-flex">
<h4 class="mt-2">{{page_name}}</h4> 
{% if page_name == "Edit Person"%}
<a class ="btn btn-link ml-auto" href="{% url 'persons:add_person' %}"
role="button">add person</a>
{% endif %}
<a class ="btn btn-link ml-auto" href="{% url 'persons:person_list' %}" role="button">person list</a>
</div>


<form name="myform" id="myform" method = "post" onsubmit="dosubmit();">
    {% csrf_token %}

<!-- adding or editing a person -->
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a href="#edit" id='edita' class="nav-link" data-toggle="tab">
		<i class="fa fa-pencil"></i></a>
		
    </li>
    <li class="nav-item">
        <a href="#minimize" id='minimizea' class="nav-link" data-toggle="tab">
		<i class="fa fa-power-off"></i></a>
    </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade" id="edit">
		<!-- person form is defined in a seperate template -->
		{% if page_name == "Edit Person" and 'unknown' not in crud.last_update %}
			{% include 'catalogue/change_log.html' %}
			{% else %} <p class="mb-4"></p>
		{% endif %}
		{% include 'persons/_person_form.html' %}
    </div>
    <div class="tab-pane fade" id="minimize">
		<!-- you can minimize the person form -->
		<br>
        <h5>{{form.instance.first_name}} {{form.instance.last_name}}</h5>
    </div>
</div>
<hr>

<!-- Inline formsets to linking persons to other items -->
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a href="#location" id='locationa' class="nav-link" data-toggle="tab">
		Locations</a>
    </li>
    <li class="nav-item">
        <a href="#text" id='texta' class="nav-link" data-toggle="tab">Texts</a>
    </li>
    <li class="nav-item">
        <a href="#illustration" id='illustrationa' class="nav-link" 
		data-toggle="tab">Illustration</a>
    </li>
    <li class="nav-item">
        <a href="#publisher" id='publishera' class="nav-link" 
		data-toggle="tab">Publisher manager</a>
    </li>
    <li class="nav-item">
        <a href="#pseudonym" id='pseudonyma' class="nav-link" 
		data-toggle="tab">pseudonym</a>
    </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade" id="location">

	{{loc_formset.management_form}}
	<table class="table table-borderless">
	<tr class ="d-flex">
	<th class="col-4">Location</th>
	<th class="col-2">Type
		<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
			href ="{% url 'persons:add_person_location_relation' %}" role="button">
			 <i class="fa fa-plus"></i></a>
		</th>
	<th class="col-2">Start</th>
	<th class="col-2">End</th>
	<th><i class="fa fa-times text-danger"></i></th>
	</tr>
	{% for f in loc_formset.forms %}
		<tr class ="d-flex">
		<td class="col-4">{{f.location}} {{f.location.errors}}</td>
		<td class="col-2">{{f.relation}} {{f.relation.errors}}</td>
		<td class="col-2">{{f.start_year}}</td>
		<td class="col-2">{{f.end_year}}</td>
		<td class="col-1">{{f.DELETE}} {{f.id}}</td>
		</tr>
	{% endfor %}
	</table>

    </div>
    <div class="tab-pane fade" id="text">
		{{txt_formset.management_form}}
		<table class="table table-borderless">
		<tr class ="d-flex">
		<th class="col-5">Text
			<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
				href ="{% url 'catalogue:add_text' 'inline' %}" role="button">
				 <i class="fa fa-plus"></i></a>
			</th>
		<th class="col-5">Role
			<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
				href ="{% url 'persons:add_person_text_relation_role' %}" 
				role="button"><i class="fa fa-plus"></i></a>
			</th>
		<th><i class="fa fa-times text-danger"></i></th>
		</tr>
		{% for f in txt_formset.forms %}
			<tr class ="d-flex">
			<td class="col-5">{{f.text}} {{f.text.errors}}</td>
			<td class="col-5">{{f.role}} {{f.role.errors}}</td>
			<td class="col-1">{{f.DELETE}} {{f.id}}</td>
			</tr>
		{% endfor %}
		</table>
    </div>
    <div class="tab-pane fade" id="illustration">
		{{ill_formset.management_form}}
		<table class="table table-borderless">
		<tr class ="d-flex">
		<th class="col-5">Illustration
			<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
				href ="{% url 'catalogue:add_illustration' 'inline' %}" 
				role="button"><i class="fa fa-plus"></i></a>
			</th>
		<th class="col-5">Role
			<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
				href ="{% url 'persons:add_person_illustration_relation_role' %}" 
				role="button"><i class="fa fa-plus"></i></a>
			</th>
		<th><i class="fa fa-times text-danger"></i></th>
		</tr>
		{% for f in ill_formset.forms %}
			<tr class ="d-flex">
			<td class="col-5">{{f.illustration}} {{f.illustration.errors}}</td>
			<td class="col-5">{{f.role}} {{f.role.errors}}</td>
			<td class="col-1">{{f.DELETE}} {{f.id}}</td>
			</tr>
		{% endfor %}
	</table>
    </div>
    <div class="tab-pane fade" id="publisher">
		{{pub_formset.management_form}}
		<table class="table table-borderless">
		<tr class ="d-flex">
		<th class="col-5">Publisher
			<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
				href ="{% url 'catalogue:add_publisher' 'inline' %}" 
				role="button"><i class="fa fa-plus"></i></a>
			</th>
		<th><i class="fa fa-times text-danger"></i></th>
		</tr>
		{% for f in pub_formset.forms %}
			<tr class ="d-flex">
			<td class="col-5">{{f.publisher}} {{f.publisher.errors}}</td>
			<td class="col-1">{{f.DELETE}} {{f.id}}</td>
			</tr>
		{% endfor %}
	</table>
    </div>
    <div class="tab-pane fade" id="pseudonym">
		<table class="table table-borderless">
		<tr class ="d-flex">
			<th class="col-10">Pseudonym(s)
			<a class = "btn btn-link btn-sm ml-auto" target = "_blank"
				href ="{% url 'persons:add_pseudonym' %}" 
				role="button"><i class="fa fa-plus"></i></a>
			</th>
		</tr>
		<tr class ="d-flex">
			<td class="col-10">{{form.pseudonym}} {{form.pseudonym.errors}}</td>
		</tr>
	</table>
    </div>
</div>
<hr> 
<input type="hidden" name="navbar" id="navbar" value="" />
<input type="hidden" name="navcontent" id="navcontent" value="" />
<input type="submit" value="Save" class="btn btn-success">
</form>

{{form.media.js}}

<script>
function set_active(){
	{% if navbar == 'default' %}
	document.getElementById('edita').className="nav-link active";
	document.getElementById('edit').className="tab-pane fade show active";
	document.getElementById('locationa').className="nav-link active";
	document.getElementById('location').className="tab-pane fade show active";
	{% else %}
	{% for nt in navbar %}
		document.getElementById('{{nt}}').className="nav-link active";
	{% endfor %}

	{% for nc in navcontent %}
		document.getElementById('{{nc}}').className="tab-pane fade show active";
	{% endfor %}
	{% endif %}
};

function get_tab_state(){
	var tab = get_ids("nav-link active")
	var content = get_ids("show active")
}

function get_ids(classname){
	var x = document.getElementsByClassName(classname);
	var i, arr = [];
	for (i=0; i < x.length; i++) {
	arr.push(x[i].id);
	}
	return arr;
}

function dosubmit(){
	document.getElementById('navbar').value = get_ids("nav-link active");
	document.getElementById('navcontent').value = get_ids("show active");
	return true;
}


$(document).ready(function(){set_active();});
</script>

{% endblock content %}


 
